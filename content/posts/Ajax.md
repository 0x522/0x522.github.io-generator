---
title: "Ajax"
date: 2020-11-10T21:34:32+08:00
draft: false
---

# Ajax

AJAX å³â€œAsynchronous JavaScript and XMLâ€ï¼ˆå¼‚æ­¥çš„ JavaScript ä¸ XML æŠ€æœ¯ï¼‰ï¼ŒæŒ‡çš„æ˜¯ä¸€å¥—ç»¼åˆäº†å¤šé¡¹æŠ€æœ¯çš„æµè§ˆå™¨ç«¯ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚

[å¼‚æ­¥:ç‚¹å‡»è¿™é‡Œäº†è§£](https://zhuanlan.zhihu.com/p/22685960)

## ä¸ºä»€ä¹ˆéœ€è¦ Ajax

&nbsp;&nbsp;&nbsp;&nbsp;ä¼ ç»Ÿçš„ Web åº”ç”¨å…è®¸ç”¨æˆ·ç«¯å¡«å†™è¡¨å•ï¼ˆformï¼‰ï¼Œå½“æäº¤è¡¨å•æ—¶å°±å‘ç½‘é¡µæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†ä¼ æ¥çš„è¡¨å•ï¼Œç„¶åé€å›ä¸€ä¸ªæ–°çš„ç½‘é¡µï¼Œä½†è¿™ä¸ªåšæ³•æµªè´¹äº†è®¸å¤šå¸¦å®½ï¼Œå› ä¸ºåœ¨å‰åä¸¤ä¸ªé¡µé¢ä¸­çš„å¤§éƒ¨åˆ† HTML ç å¾€å¾€æ˜¯ç›¸åŒçš„ã€‚ç”±äºæ¯æ¬¡åº”ç”¨çš„æ²Ÿé€šéƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œåº”ç”¨çš„å›åº”æ—¶é—´ä¾èµ–äºæœåŠ¡å™¨çš„å›åº”æ—¶é—´ã€‚è¿™å¯¼è‡´äº†ç”¨æˆ·ç•Œé¢çš„å›åº”æ¯”æœ¬æœºåº”ç”¨æ…¢å¾—å¤šã€‚

&nbsp;&nbsp;&nbsp;&nbsp;ä¸æ­¤ä¸åŒï¼ŒAJAX åº”ç”¨å¯ä»¥ä»…å‘æœåŠ¡å™¨å‘é€å¹¶å–å›å¿…é¡»çš„æ•°æ®ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯é‡‡ç”¨ JavaScript å¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„å›åº”ã€‚å› ä¸ºåœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®å¤§é‡å‡å°‘ï¼ŒæœåŠ¡å™¨å›åº”æ›´å¿«äº†ã€‚åŒæ—¶ï¼Œå¾ˆå¤šçš„å¤„ç†å·¥ä½œå¯ä»¥åœ¨å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯æœºå™¨ä¸Šå®Œæˆï¼Œå› æ­¤ Web æœåŠ¡å™¨çš„è´Ÿè·ä¹Ÿå‡å°‘äº†ã€‚

## ä½¿ç”¨ Ajax å¯ä»¥åšä»€ä¹ˆ

- æ³¨å†Œæ—¶ï¼Œè¾“å…¥ç”¨æˆ·åè‡ªåŠ¨æ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨ã€‚

- ç™»é™†æ—¶ï¼Œæç¤ºç”¨æˆ·åå¯†ç é”™è¯¯

- åˆ é™¤æ•°æ®è¡Œæ—¶ï¼Œå°†è¡Œ ID å‘é€åˆ°åå°ï¼Œåå°åœ¨æ•°æ®åº“ä¸­åˆ é™¤ï¼Œæ•°æ®åº“åˆ é™¤æˆåŠŸåï¼Œåœ¨é¡µé¢ DOM ä¸­å°†æ•°æ®è¡Œä¹Ÿåˆ é™¤ã€‚
- ç­‰ç­‰

## åŸç”Ÿ Ajax

### XMLHttpRequest å¯¹è±¡

æµè§ˆå™¨å†…å»ºå¯¹è±¡ï¼Œç”¨äºåœ¨åå°ä¸æœåŠ¡å™¨é€šä¿¡(äº¤æ¢æ•°æ®) ï¼Œç”±æ­¤æˆ‘ä»¬ä¾¿å¯å®ç°å¯¹ç½‘é¡µçš„éƒ¨åˆ†æ›´æ–°ï¼Œè€Œä¸æ˜¯åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

æ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆIE7+ã€Firefoxã€Chromeã€Safari ä»¥åŠ Operaï¼‰å‡å†…å»º XMLHttpRequest å¯¹è±¡ã€‚

```javascript
var xhr = new XMLHttpRequest();
```

å¦‚æœéœ€è¦å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨ XMLHttpRequest å¯¹è±¡çš„ open() å’Œ send() æ–¹æ³•ã€‚

```javascript
var xhr = new XMLHttpRequest();
xhr.open("GET", "ajax_info.json", true);
xhr.send();
```

| æ–¹æ³•                   | æè¿°                                                                                                                                                           |
| ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| open(method,url,async) | è§„å®šè¯·æ±‚çš„ç±»å‹ã€URL ä»¥åŠæ˜¯å¦å¼‚æ­¥å¤„ç†è¯·æ±‚ã€‚<br>**method**ï¼šè¯·æ±‚çš„ç±»å‹ï¼›GET æˆ– POST <br>**url**ï¼šæ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½®<br>**async**ï¼štrueï¼ˆå¼‚æ­¥ï¼‰æˆ– falseï¼ˆåŒæ­¥ï¼‰ |
| send(string)           | å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚stringï¼šä»…ç”¨äº POST è¯·æ±‚                                                                                                                   |

#### XMLHttpRequest å¯¹è±¡çš„ç›¸å…³å±æ€§å’Œäº‹ä»¶

| å±æ€§               | è¯´æ˜                                                                                                                                                                                  |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| status             | 200: "OK"                                                                                                                                                                             |
| responseText       | è·å¾—å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®ã€‚                                                                                                                                                            |
| responseXML        | è·å¾— XML å½¢å¼çš„å“åº”æ•°æ®ã€‚                                                                                                                                                             |
| readyState         | å­˜æœ‰ XMLHttpRequest çš„çŠ¶æ€ã€‚è¯·æ±‚å‘é€åˆ°åå°åï¼ŒçŠ¶æ€ä¼šä» 0 åˆ° 4 å‘ç”Ÿå˜åŒ–ã€‚ <br> 0: è¯·æ±‚æœªåˆå§‹åŒ–<br>1: æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹<br>2: è¯·æ±‚å·²æ¥æ”¶<br>3: è¯·æ±‚å¤„ç†ä¸­<br>4: è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª |
| onreadystatechange | æ¯å½“ readyState å±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚                                                                                                                                          |

**å¯ä»¥é€šè¿‡ç›‘å¬ XMLHttpRequest å¯¹è±¡çš„ onreadystatechange äº‹ä»¶ï¼Œåœ¨äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­åˆ¤æ–­ readyState çš„çŠ¶æ€ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå¯¹è±¡è¯·æ±‚ç»“æœçš„åˆ¤æ–­å¤„ç†ã€‚**

### GET è¯·æ±‚

get è¯·æ±‚å‚æ•°éœ€è¦æ”¾åœ¨ url åœ°å€çš„å‚æ•°ä¸­ã€‚å¹¶é€šè¿‡ urlencode (ç™¾åˆ†å·ç¼–ç )çš„æ–¹å¼ä¼ å‚ï¼Œä¹Ÿå°±æ˜¯`?`éš”å¼€ url å’Œå‚æ•°ï¼Œç„¶åå¤šä¸ªå‚æ•°ç”¨`&`è¿æ¥ï¼Œå‚æ•°æ ¼å¼ä¸ºï¼š`key=value`ï¼Œget è¯·æ±‚å¯¹æ•°æ®é•¿åº¦æœ‰é™åˆ¶ï¼Œurl çš„æœ€å¤§é•¿åº¦æ˜¯ 2048 ä¸ªå­—ç¬¦ã€‚

```javascript
// getè¯·æ±‚
var xhr = new XMLHttpRequest();

xhr.open("GET", "/com/ajax?a=1&b=2", true);
xhr.send();

xhr.onreadystatechange = function (e) {
  if (xhr.readyState == 4 && xhr.status == 200) {
    console.log(xhr.responseText);
  }
};
```

### POST è¯·æ±‚

post è¯·æ±‚éœ€è¦æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œè®©åå°çŸ¥é“æˆ‘ä»¬è¯·æ±‚çš„å‚æ•°çš„æ ¼å¼ï¼Œè¿™æ ·åå°æ‰èƒ½è§£ææˆ‘ä»¬çš„æ•°æ®ã€‚post è¯·æ±‚ç›¸å¯¹ä¸ get è¯·æ±‚æ›´åŠ å®‰å…¨ï¼Œå‘é€çš„æ•°æ®è¢«æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œè€Œä¸ä¼šå‡ºç°åœ¨ url ä¸­ï¼Œè€Œä¸”å¯¹æ•°æ®çš„é•¿åº¦æ²¡æœ‰é™åˆ¶ã€‚å¦å¤–ï¼Œä¼ è¾“çš„æ•°æ®éœ€è¦æ ¼å¼åŒ–åˆ° send æ–¹æ³•ä¸­ã€‚

```javascript
// postè¯·æ±‚
var xhr = new XMLHttpRequest();
xhr.open("POST", "/com/ajax", true)
xhr.setRequestHeader("Content-type", "application/json");
xhr.send("{ "face": "ğŸ˜‚" }");
xhr.onreadystatechange = function (e) {
  if (xhr.readyState == 4 && xhr.status == 200) {
    console.log(xhr.responseText);
  }
};

```

### å°è£…åŸç”Ÿ Ajax è¯·æ±‚

**GET**<br>

```javascript
/**
 * @param {String} url  è¯·æ±‚åå°çš„åœ°å€ã€‚
 * @param {Function} callback  è¯·æ±‚æˆä¹‹åï¼Œè¿”å›æ•°æ®æˆåŠŸï¼Œå¹¶ä¸”è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°å°±æ˜¯åå°è¿”å›çš„æ•°æ®ã€‚
 */
function ajaxGet(url, callback) {
  var xhr = new XMLHttpRequest();
  xhr.open("GET", url, true);
  xhr.send();

  xhr.onreadystatechange = function () {
    if (xhr.readyState == 4 && xhr.status == 200) {
      callback(xhr.responseText);
    }
  };
}

// è°ƒç”¨
ajaxGet("/api/users", function (data) {
  console.log(data);
});
```

**POST**<br>

```javascript
/**
 * @param {String} url  è¯·æ±‚åå°çš„åœ°å€ã€‚
 * @param {String} data  å‘é€è¯·æ±‚çš„æ•°æ®ï¼Œåœ¨è¯·æ±‚ä½“ä¸­ã€‚
 * @param {Function} callback  è¯·æ±‚æˆä¹‹åï¼Œè¿”å›æ•°æ®æˆåŠŸï¼Œå¹¶ä¸”è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°å°±æ˜¯åå°è¿”å›çš„æ•°æ®ã€‚

 */
function ajaxPost(url, data, callback) {
  var xhr = new XMLHttpRequest();
  xhr.open("POST", url, true);
  xhr.setRequestHeader("Content-type", "application/json");
  xhr.send(data);

  xhr.onreadystatechange = function () {
    if (xhr.readyState == 4 && xhr.status == 200) {
      callback(xhr.responseText);
    }
  };
}

// è°ƒç”¨
ajaxPost("/api/users", "{"id":"1","name":"john","age":"1"}", function (data) {
  var user = JSON.parse(data);
  console.log(user.id);
  console.log(user.name);
  console.log(user.age);
});
```

## JQuery çš„ Ajax

jQuery æä¾›å¤šä¸ªä¸ AJAX æœ‰å…³çš„æ–¹æ³•ã€‚

é€šè¿‡ jQuery AJAX æ–¹æ³•ï¼Œæ‚¨èƒ½å¤Ÿä½¿ç”¨ HTTP Get å’Œ HTTP Post ä»è¿œç¨‹æœåŠ¡å™¨ä¸Šè¯·æ±‚æ–‡æœ¬ã€HTMLã€XML æˆ– JSON â€“ åŒæ—¶æ‚¨èƒ½å¤ŸæŠŠè¿™äº›å¤–éƒ¨æ•°æ®ç›´æ¥è½½å…¥ç½‘é¡µçš„è¢«é€‰å…ƒç´ ä¸­ã€‚

jQuery Ajax æœ¬è´¨å°±æ˜¯ XMLHttpRequestï¼Œå¯¹ä»–è¿›è¡Œäº†å°è£…ï¼Œæ–¹ä¾¿è°ƒç”¨ï¼

```javascript
jQuery.ajax(...)
    éƒ¨åˆ†å‚æ•°ï¼š
        urlï¼šè¯·æ±‚åœ°å€
        typeï¼šè¯·æ±‚æ–¹å¼ï¼ŒGETã€POSTï¼ˆ1.9.0ä¹‹åç”¨methodï¼‰
        headersï¼šè¯·æ±‚å¤´
        dataï¼šè¦å‘é€çš„æ•°æ®
        contentTypeï¼šå³å°†å‘é€ä¿¡æ¯è‡³æœåŠ¡å™¨çš„å†…å®¹ç¼–ç ç±»å‹(é»˜è®¤: "application/x-www-form-urlencoded; charset=UTF-8")
        asyncï¼šæ˜¯å¦å¼‚æ­¥
        timeoutï¼šè®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        beforeSendï¼šå‘é€è¯·æ±‚å‰æ‰§è¡Œçš„å‡½æ•°(å…¨å±€)
        completeï¼šå®Œæˆä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
        successï¼šæˆåŠŸä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
        errorï¼šå¤±è´¥ä¹‹åæ‰§è¡Œçš„å›è°ƒå‡½æ•°(å…¨å±€)
        acceptsï¼šé€šè¿‡è¯·æ±‚å¤´å‘é€ç»™æœåŠ¡å™¨ï¼Œå‘Šè¯‰æœåŠ¡å™¨å½“å‰å®¢æˆ·ç«¯å¯æ¥å—çš„æ•°æ®ç±»å‹
        dataTypeï¼šå°†æœåŠ¡å™¨ç«¯è¿”å›çš„æ•°æ®è½¬æ¢æˆæŒ‡å®šç±»å‹
        "xml": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆxmlæ ¼å¼
        "text": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼
        "html": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼ï¼Œåœ¨æ’å…¥DOMä¸­æ—¶ï¼Œå¦‚æœåŒ…å«JavaScriptæ ‡ç­¾ï¼Œåˆ™ä¼šå°è¯•å»æ‰§è¡Œã€‚
        "script": å°è¯•å°†è¿”å›å€¼å½“ä½œJavaScriptå»æ‰§è¡Œï¼Œç„¶åå†å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆæ™®é€šæ–‡æœ¬æ ¼å¼
        "json": å°†æœåŠ¡å™¨ç«¯è¿”å›çš„å†…å®¹è½¬æ¢æˆç›¸åº”çš„JavaScriptå¯¹è±¡
        "jsonp": JSONP æ ¼å¼ä½¿ç”¨ JSONP å½¢å¼è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚ "myurl?callback=?" jQuery å°†è‡ªåŠ¨æ›¿æ¢ ? ä¸ºæ­£ç¡®çš„å‡½æ•°åï¼Œä»¥æ‰§è¡Œå›è°ƒå‡½æ•°
```

### Ajax å®æˆ˜

Jquery å‘é€ ajax è¯·æ±‚çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„æ˜¯
`$.ajaxæ–¹æ³•`ï¼Œåœ¨å…¶ä¹‹ä¸Šå°è£…çš„æ–¹æ³•æœ‰` $.get, $.post, $.put, $.ajaxForm, $.fileUpload` ç­‰ã€‚

`$.get` è¯·æ±‚åŠŸèƒ½ä»¥å–ä»£å¤æ‚ \$.ajax ã€‚è¯·æ±‚æˆåŠŸæ—¶å¯è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å¦‚æœéœ€è¦åœ¨å‡ºé”™æ—¶æ‰§è¡Œå‡½æ•°ï¼Œè¯·ä½¿ç”¨ `$.ajax`ã€‚

**jQuery.get()**

**\$(selector).get(url,data,success(response,status,xhr),dataType)**

|                              |                                                                                                                                                        |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| url                          | å¿…éœ€ã€‚è§„å®šå°†è¯·æ±‚å‘é€çš„å“ªä¸ª URLã€‚                                                                                                                       |
| data                         | å¯é€‰ã€‚è§„å®šè¿åŒè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ã€‚                                                                                                                 |
| success(response,status,xhr) | å¯é€‰ã€‚è§„å®šå½“è¯·æ±‚æˆåŠŸæ—¶è¿è¡Œçš„å‡½æ•°ã€‚<br>é¢å¤–çš„å‚æ•°ï¼š<br>response - åŒ…å«æ¥è‡ªè¯·æ±‚çš„ç»“æœæ•°æ® <br>status - åŒ…å«è¯·æ±‚çš„çŠ¶æ€ <br>xhr - åŒ…å« XMLHttpRequest å¯¹è±¡ |
| dataType                     | å¯é€‰ã€‚è§„å®šé¢„è®¡çš„æœåŠ¡å™¨å“åº”çš„æ•°æ®ç±»å‹ã€‚<br>é»˜è®¤åœ°ï¼ŒjQuery å°†æ™ºèƒ½åˆ¤æ–­ã€‚<br>å¯èƒ½çš„ç±»å‹ï¼š<br>"xml"<br>"html"<br>"text"<br>"script"<br>"json"<br>"jsonp"    |

```javascript
$.ajax({
  type: "GET",
  url: url,
  data: data,
  success: success,
  dataType: dataType,
});
```

```javascript
$.get(
  "${pageContext.request.contextPath}/yourRequestMapping",
  {
    id: "1",
    name: "zhangsan",
  },
  function (data, status) {
    //è¿™é‡Œæ˜¾ç¤ºä»æœåŠ¡å™¨è¿”å›çš„æ•°æ®
    alert(data);
    //è¿™é‡Œæ˜¾ç¤ºè¿”å›çš„çŠ¶æ€
    alert(status);
  },
  "json"
);
```

**jQuery.post()**

post() æ–¹æ³•é€šè¿‡ HTTP POST è¯·æ±‚ä»æœåŠ¡å™¨è½½å…¥æ•°æ®

**\${selector}.post(url,data,success(data, textStatus, jqXHR),dataType)**

|                                  |                                                                                       |
| -------------------------------- | ------------------------------------------------------------------------------------- |
| url                              | å¿…éœ€ã€‚è§„å®šæŠŠè¯·æ±‚å‘é€åˆ°å“ªä¸ª URLã€‚                                                      |
| data                             | å¯é€‰ã€‚æ˜ å°„æˆ–å­—ç¬¦ä¸²å€¼ã€‚è§„å®šè¿åŒè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ã€‚                                |
| success(data, textStatus, jqXHR) | å¯é€‰ã€‚è¯·æ±‚æˆåŠŸæ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚                                                      |
| dataType                         | å¯é€‰ã€‚è§„å®šé¢„æœŸçš„æœåŠ¡å™¨å“åº”çš„æ•°æ®ç±»å‹ã€‚é»˜è®¤æ‰§è¡Œæ™ºèƒ½åˆ¤æ–­ï¼ˆxmlã€jsonã€script æˆ– htmlï¼‰ã€‚ |

```javascript
$.ajax({
  type: "POST",
  url: url,
  data: data,
  success: success,
  dataType: dataType,
});
```

```javascript
$.post(
  "${pageContext.request.contextPath}/yourRequestMapping",
  {
    id: "1",
    name: "zhangsan",
  },
  function (data, status) {
    //è¿™é‡Œæ˜¾ç¤ºä»æœåŠ¡å™¨è¿”å›çš„æ•°æ®
    alert(data);
    //è¿™é‡Œæ˜¾ç¤ºè¿”å›çš„çŠ¶æ€
    alert(status);
  },
  "json"
);
```
